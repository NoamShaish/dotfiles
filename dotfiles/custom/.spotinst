#!/bin/bash

# -=-= TERRAFORM =-=-
load_terraform_provider_spotinst() {
  local providerFilename="terraform-provider-spotinst_v0.12.0"
  local providerBuildPath="${GOPATH}/src/github.com/terraform-providers/terraform-provider-spotinst"
  local providerPath=${TERRAFORM_FILES}/internals/.terraform.d/plugins/darwin_amd64

  cur=$(pwd)
  cd ${providerBuildPath}

  make fmt
  go build -o ${providerFilename}
  sudo chmod +x ${providerFilename}
  sudo mv ${providerFilename} ${providerPath}

  echo -e "
Built and copied latest spotinst-terraform-provider:
  Name..........: ${providerFilename}
  Build Source..: ${providerBuildPath}
  Destination...: ${providerPath}
"

  cd ${cur}
}

test_terraform_provider_spotinst() {
  local test_name=$1
  local test_args=""
  local providerBuildPath="${GOPATH}/src/github.com/terraform-providers/terraform-provider-spotinst"

  cur=$(pwd)
  cd ${providerBuildPath}

  if [[ ! -z ${test_name} ]]; then
    test_args="TESTARGS='-run=${test_name}'"
  fi

  make testacc spotinst ${test_args}

  echo -e "
Executed acceptance tests on latest spotinst-terraform-provider:
  Build Source..: ${providerBuildPath}
  Test Name.....: ${test_name}
"

  cd ${cur}
}