#!/bin/bash

print_banner() {
  echo -e "
██████╗ ██████╗ ███████╗██╗    ██╗    ██╗███╗   ██╗███████╗████████╗ █████╗ ██╗     ██╗
██╔══██╗██╔══██╗██╔════╝██║    ██║    ██║████╗  ██║██╔════╝╚══██╔══╝██╔══██╗██║     ██║
██████╔╝██████╔╝█████╗  ██║ █╗ ██║    ██║██╔██╗ ██║███████╗   ██║   ███████║██║     ██║
██╔══██╗██╔══██╗██╔══╝  ██║███╗██║    ██║██║╚██╗██║╚════██║   ██║   ██╔══██║██║     ██║
██████╔╝██║  ██║███████╗╚███╔███╔╝    ██║██║ ╚████║███████║   ██║   ██║  ██║███████╗███████╗
╚═════╝ ╚═╝  ╚═╝╚══════╝ ╚══╝╚══╝     ╚═╝╚═╝  ╚═══╝╚══════╝   ╚═╝   ╚═╝  ╚═╝╚══════╝╚══════╝
"
}

# Homebrew cheatsheet
# -----------------------------------
# brew install git          Install a package
# brew install git@2.0.0    Install a package with specific version
# brew upgrade git          Upgrade a package
# brew unlink git           Unlink
# brew link git             Link
# brew switch git 2.5.0     Change versions
# brew list --versions git  See what versions you have
# --
# brew info git             List versions, caveats, etc
# brew cleanup git          Remove old versions
# brew edit git             Edit this formula
# brew cat git              Print this formula
# brew home git             Open homepage
# --
# brew update               Update brew and cask
# brew list                 List installed
# brew outdated             What’s due for upgrades?
# -----------------------------------

#
# This file should be executed manually to install all homebrew casks
# Installation paths:
#   - /usr/local/Homebrew - Homebrew cloned repository
#   - /usr/local/Cellar   - Homebrew packages
#   - /usr/local/Caskroom - Homebrew casks
#   - /usr/local/opt      - symlinks to manage versioning to Cellar/Caskroom folders
#

declare -a PACKAGES=("zsh"
                     "fzf"
                     "git"
                     "vegeta"
                     "jmeter"
                     "wget"
                     "telnet"
                     "kubernetes-cli"
                     "kubernetes-helm"
                     "gradle")

declare -a CASKS=("alfred"
                  "google-chrome"
                  "spotify"
                  "tableplus"
                  "slack"
                  "telegram"
                  "sublime-text"
                  "visual-studio-code"
                  "iterm2"
                  "flux"
                  "muzzle"
                  "postman"
                  "spectacle"
                  "tunnelbear"
                  "zoomus"
                  "docker"
                  "macpass"
                  "kap")

# Manual Download & install:
#   - IntelliJ IDEA
#   - Goland
#   - JSON xml parser (iTunes)
#   - Monosnap
#   - Unsplash Wallpapers (iTunes)

install_homebrew() {

    echo -e "
=======================================================================
                         Installing HomeBrew
=======================================================================
"

# Installation to a manual folder - not recommended but optional
#
#  if [[ ! -d "~/.homebrew" ]]; then
#    echo -------------------------- Installing Homebrew ---------------------------
#
#    mkdir ~/.homebrew && cd ~/.homebrew
#    curl -L https://github.com/Homebrew/brew/tarball/master | tar xz --strip 1 -C homebrew
#  fi

  if [[ ! -d "/usr/local/Homebrew" ]]; then
    echo "  Installing..."
    /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
  else
    echo "  Already installed."
  fi

  echo -e "\n    Done.\n"
}

install_homebrew_taps() {
  echo "  Tapping to homebrew/cask-versions..."
  # cask-versions enable us to search supported versions by providing a cask name:
  #   - brew search <cask name>
  brew tap homebrew/cask-versions
  echo -e "\n    Done.\n"
}

install_packages() {
  if [[ -z "${PACKAGES}" ]]; then
    return
  fi

    echo -e "
=======================================================================
                      Installing HomeBrew Packages
=======================================================================
"

  for pkg in "${PACKAGES[@]}"
  do
    echo -e "
===================
Installing Package: ${pkg}
===================
"
    brew install ${pkg}
  done

  echo -e "\n    Done.\n"
}

# install_casks Function
# -----------------------------------
# Retrieve casks information:
#   - brew search <cask name>
#   - brew cask info <cask name>
# -----------------------------------
install_casks() {
  if [[ -z "${CASKS}" ]]; then
    return
  fi

echo -e "
=======================================================================
                      Installing HomeBrew Casks
=======================================================================
"

  for cask in "${CASKS[@]}"
  do
    echo -e "
===================
Installing Cask: ${cask}
===================
"
    brew cask install ${cask}
  done

  echo -e "\n    Done.\n"
}

list_all() {
  echo -e "
  ==> Installed Homebrew Packages:
"
  brew leaves

echo -e "
  ==> Installed Homebrew Casks:
"
  brew cask list

  echo -e "\n    Done.\n"
}

verify_pre_install() {
  read -p "Do you want to install Homebrew with additional packages and casks? (y/n): " input
  if [[ ${input} != "y" ]]; then
    echo -e "\n    Nothing has changed.\n"
    exit 0
  fi
}

main() {
  print_banner
  verify_pre_install
  install_homebrew
  install_homebrew_taps
  install_packages
  install_casks
  list_all
}

main "$@"
